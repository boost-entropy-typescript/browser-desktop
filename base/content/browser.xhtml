#filter substitution
<?xml version="1.0"?>
# -*- Mode: HTML -*-
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!-- The "global.css" stylesheet is imported first to allow other stylesheets to
    override rules using selectors with the same specificity. This applies to
    both "content" and "skin" packages, which bug 1385444 will unify later. -->
<?xml-stylesheet href="chrome://global/skin/global.css" type="text/css"?>

<?xml-stylesheet href="chrome://browser/skin/searchbar.css" type="text/css"?>

<html id="main-window"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns="http://www.w3.org/1999/xhtml"
    data-l10n-id="browser-main-window-window-titles"
    data-l10n-args="{&quot;content-title&quot;:&quot;CONTENTTITLE&quot;}"
    data-l10n-attrs="data-content-title-default, data-content-title-private, data-title-default, data-title-private"
#ifdef XP_WIN
    chromemargin="0,2,2,2"
#else
    chromemargin="0,-1,-1,-1"
#endif
    tabsintitlebar="true"
    windowtype="navigator:browser"
    macanimationtype="document"
    macnativefullscreen="true"
    screenX="4" 
    screenY="4"
    sizemode="normal"
    retargetdocumentfocus="urlbar-input"
    scrolling="false"
    persist="screenX screenY width height sizemode"
>
    <head>
        <link rel="stylesheet" href="chrome://dot/skin/browser.css" />

        <link rel="localization" href="branding/brand.ftl"/>
        <link rel="localization" href="dot/browser.ftl"/>
        <link rel="localization" href="browser/browserSets.ftl"/>

        <link rel="localization" href="browser/search.ftl"/>
        <link rel="localization" href="branding/brand.ftl"/>
        <link rel="localization" href="browser/branding/sync-brand.ftl"/>
        <link rel="localization" href="browser/branding/brandings.ftl"/>
        <link rel="localization" href="toolkit/global/textActions.ftl"/>
        <link rel="localization" href="browser/browser.ftl"/>
        <link rel="localization" href="browser/browserContext.ftl"/>
        <link rel="localization" href="browser/menubar.ftl"/>
        <link rel="localization" href="browser/protectionsPanel.ftl"/>
        <link rel="localization" href="browser/appmenu.ftl"/>
        <link rel="localization" href="browser/panelUI.ftl"/>
        <link rel="localization" href="preview/identityCredentialNotification.ftl"/>
        <link rel="localization" href="preview/interventions.ftl"/>
        <link rel="localization" href="browser/sidebarMenu.ftl"/>
        <link rel="localization" href="browser/allTabsMenu.ftl"/>
        <link rel="localization" href="browser/places.ftl"/>
        <link rel="localization" href="toolkit/printing/printUI.ftl"/>
        <link rel="localization" href="browser/tabbrowser.ftl"/>
        <link rel="localization" href="preview/firefoxSuggest.ftl"/>
        <link rel="localization" href="browser/toolbarContextMenu.ftl"/>
        <link rel="localization" href="browser/screenshots.ftl"/>
        <link rel="localization" href="browser/firefoxView.ftl"/>
        <link rel="localization" href="browser/webrtcIndicator.ftl"/>
        <link rel="localization" href="browser/originControls.ftl"/>
        <link rel="localization" href="browser/unifiedExtensions.ftl"/>

        <title data-l10n-id="browser-main-window-title"></title>

        <script>
            // Important utilities/globals for browser
            Services.scriptloader.loadSubScript("resource://dot/base/content/browser-utils.js", this);

            Services.scriptloader.loadSubScript("chrome://browser/content/browser.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/browser-places.js", this);
            Services.scriptloader.loadSubScript("chrome://global/content/globalOverlay.js", this);
            Services.scriptloader.loadSubScript("chrome://global/content/editMenuOverlay.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/utilityOverlay.js", this);
            if (AppConstants.platform == "macosx") {
                Services.scriptloader.loadSubScript("chrome://global/content/macWindowMenu.js", this);
            }
        </script>
        <script>
            var { AppConstants } = ChromeUtils.importESModule(
                "resource://gre/modules/AppConstants.sys.mjs"
            );

            // Sets up DevTools connection for debugging if in a non-release build
            if (!AppConstants.MOZILLA_OFFICIAL) {
                Services.scriptloader.loadSubScript(
                    "resource://dot/base/content/browser-development-helpers.js", 
                    this
                );

                document.documentElement.removeAttribute("remotecontrol");
            }

            Services.scriptloader.loadSubScript("chrome://global/content/contentAreaUtils.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/browser-captivePortal.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/browser-pageActions.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/browser-sidebar.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/browser-tabsintitlebar.js", this);

            Services.scriptloader.loadSubScript("chrome://browser/content/tabbrowser.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/tabbrowser-tab.js", this);
            Services.scriptloader.loadSubScript("chrome://browser/content/tabbrowser-tabs.js", this);

            Services.scriptloader.loadSubScript("chrome://browser/content/places/places-menupopup.js", this);

            Services.scriptloader.loadSubScript(
                "chrome://browser/content/search/autocomplete-popup.js",
                this
            );
            Services.scriptloader.loadSubScript("chrome://browser/content/search/searchbar.js", this);

            Services.scriptloader.loadSubScript("resource://dot/base/content/browser-init.js", this);

            window.addEventListener(
                "MozBeforeInitialXULLayout",
                dBrowserInit.onBeforeInitialXULLayout.bind(dBrowserInit),
                { once: true }
            );

            window.addEventListener("DOMContentLoaded", dBrowserInit.onDOMContentLoaded.bind(dBrowserInit), {
                once: true
            });

            /* Initialise events */
            window.addEventListener("load", dBrowserInit.onLoad.bind(dBrowserInit));
            window.addEventListener("unload", dBrowserInit.onUnload.bind(dBrowserInit));
            window.addEventListener("close", dBrowserInit.onWindowClosing);
        </script>
    </head>

    <html:body xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
        <html:div id="popupSets" hidden="true">
            <html:browser-statuspanel id="statuspanel"></html:browser-statuspanel>
        </html:div>

        <html:div id="mount">
            
        </html:div>

        <hbox flex="1" id="browser" hidden="true">
            <vbox id="sidebar-box" hidden="true" class="chromeclass-extrachrome">
                <box id="sidebar-header" align="center">
                    <toolbarbutton id="sidebar-switcher-target" class="tabbable">
                        <image id="sidebar-icon" consumeanchor="sidebar-switcher-target"/>
                        <label id="sidebar-title" crop="end" control="sidebar"/>
                        <image id="sidebar-switcher-arrow"/>
                    </toolbarbutton>
                    <image id="sidebar-throbber"/>
                    <spacer id="sidebar-spacer"/>
                    <toolbarbutton id="sidebar-close" class="close-icon tabbable" data-l10n-id="sidebar-close-button" oncommand="SidebarUI.hide();"/>
                </box>
                <browser id="sidebar" autoscroll="false" disablehistory="true" disablefullscreen="true" tooltip="aHTMLTooltip"/>
            </vbox>
            <splitter id="sidebar-splitter" class="chromeclass-extrachrome sidebar-splitter" resizebefore="sibling" resizeafter="none" hidden="true"/>
            <vbox id="appcontent" flex="1">
                <!-- gNotificationBox will be added here lazily. -->
                <tabbox id="tabbrowser-tabbox"
                        flex="1" tabcontainer="tabbrowser-tabs">
                    <tabpanels id="tabbrowser-tabpanels"
                                flex="1" selectedIndex="0"/>
                </tabbox>
            </vbox>
        </hbox>

        <html:div id="ff-internals">
            #include ../../../browser/base/content/browser-sets.inc

            #include ../../../browser/base/content/main-popupset.inc.xhtml
    
            #include ../../../browser/base/content/appmenu-viewcache.inc.xhtml
            #include ../../../browser/base/content/unified-extensions-viewcache.inc.xhtml
    
            <html:dialog id="window-modal-dialog" style="visibility: hidden; height: 0; width: 0"/>
            <html:template id="window-modal-dialog-template">
              <vbox class="dialogTemplate dialogOverlay" align="center" topmost="true">
                <hbox class="dialogBox">
                  <browser class="dialogFrame" autoscroll="false" disablehistory="true"/>
                </hbox>
              </vbox>
            </html:template>
    
            #include ../../../browser/base/content/navigator-toolbox.inc.xhtml
        </html:div>

        <html:template id="customizationPanel">
            <box id="customization-container" flex="1" hidden="true"><![CDATA[
        #include ../../../browser/components/customizableui/content/customizeMode.inc.xhtml
            ]]></box>
          </html:template>
        
        <html:div id="a11y-announcement" role="alert"/>
    </html:body>
</html>